<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="format-detection" content="telephone=no">
        <title>主页</title>
        <script type="text/javascript" src="http://tajs.qq.com/stats?sId=37342703" charset="UTF-8"></script>
        <link rel="stylesheet" href="../css/frozen.css">
        <link rel="stylesheet" href="../css/style.css" />
        
        <script src="../lib/zepto.min.js"></script>
        <script src="../js/frozen.js"></script>
        <script src="../js/Utils.js"></script>
        
        <script type="text/javascript" src="../H5Js/immersed.js" ></script>
		<script type="text/javascript" src="../H5Js/shortcut.js" ></script>
        
        <style type="text/css">
       	 	html,body{height: 100%;width: 100%;font-family: "微软雅黑";background-color: #FFFFFF;}
        	.footer_icon, .footer_title{display:block;float: none; margin-top: -8px;font-size: 15px;}
			.footer_icon>i{font-size:28px;color: #FFFFFF;}  
			.ui-footer-btn{font-family: "微软雅黑";background-color: #279DC9; background-image: none;} 
			.footer_item{color: #FFFFFF;} 
			.footer_item.active{color: #FFFFFF; font-weight: bold;} 
			.footer_item.active>.footer_icon>i{color: #FFFFFF; font-weight: bold;}
			#list{width: 100%;height: 100%;}
			#main_frame{display: block;width:100%;height: 100%;}
			#main_div{display: block;float: left; width: 100%;height: 100%;}
			.msg_num{display: block; position: fixed;bottom: 35px;left: 51.7%;min-width: 16px;max-width: 50px; height: 16px;background-color: #FF0000;border-radius: 50%;color: #FFFFFF;font-size: 12px;line-height:16px;text-align: center;}
        </style> 
    </head> 
    
    <body ontouchstart>
        <div id="main_div">
        	<iframe src="index.html" id="main_frame" name="iframe_1" frameborder="0" ></iframe>	
        </div>
        <footer class="ui-footer ui-footer-btn">
            <ul class="ui-tiled ui-border-t">
                <li class="footer_item active home">
                	<span class="footer_icon"><i class="ui-icon ui-icon-home"></i></span>
                	<span class="footer_title">主页</span>
                </li>
                <li class="footer_item msg" >
                	<span class="footer_icon">
                		<i class="ui-icon ui-icon-comment"></i>
                		<span id="message_number" class=""></span>
                	</span>
                	<span class="footer_title">消息</span>
                </li>
                <li class="footer_item myHome" >
                	<span class="footer_icon"><i class="ui-icon ui-icon-personal"></i></span>
                	<span class="footer_title">我</span>
                </li>
             </ul>
        </footer>
        
        <script type="text/javascript">	
        	function changeData(number, elementId){
        		if(number != 0){
			    	$("#main_frame").contents().find("#"+elementId).html(number);
				    $("#main_frame").contents().find("#"+elementId).addClass("ui-badge-cornernum");
			    }else{
			    	$("#main_frame").contents().find("#"+elementId).html("");
				    $("#main_frame").contents().find("#"+elementId).removeClass("ui-badge-cornernum");
			    }
        	}
        	$(function(){
				// 创建一个Socket实例
//				var socket = new WebSocket('ws://http://localhost:8080/zjhospital-app/websocket/socketServer?userId=' + localStorage.getItem("patientId"));
				
				//var socket = new WebSocket('ws://http://219.137.32.146:8082/zjhospital-app/websocket/socketServer?userId=' + localStorage.getItem("patientId"));
				var socket = new WebSocket('ws://'+Utils.getRoot()+'/websocket/socketServer?userId=' + localStorage.getItem("patientId"));
				// 打开Socket
				socket.onopen = function(event) {
				  console.log('open', event); 
				}
				  // 监听消息
				socket.onmessage = function(event) {
				    console.log(event.data, event)
				    var obj = JSON.parse(event.data);
				    if(obj.zs != 0){
				    	$("#message_number").html(obj.zs);
				    	$("#message_number").addClass("msg_num");
				    }else{
				    	$("#message_number").html("");
				    	$("#message_number").removeClass("msg_num");
				    }
				    changeData(obj.sx, "message_type_1");
				    changeData(obj.tz, "message_type_2");
				    changeData(obj.yy, "message_type_3");
				    changeData(obj.jf, "message_type_4");
				}
				  // 监听Socket的关闭
				socket.onclose = function(event) {
				  //console.log('closed', event); 
				};
        		
        		$(".footer_item").click(function(){
        			var a = $(this).hasClass(("active"));
        			var home = $(this).hasClass(("home"));
        			var msg = $(this).hasClass(("msg"));
        			var myHome = $(this).hasClass(("myHome"));
        			if(!a){
        				$(this).addClass("active").siblings("li").removeClass("active");
        				if(home){
        					$("#main_frame").attr("src","main.html");
        				}
    					if(msg){
        					$("#main_frame").attr("src","message1.html");
        				}
						if(myHome){
        					$("#main_frame").attr("src","mySelf.html");
        				}
        			}
        		})
        	});
        	
        	var as='pop-in';// 默认窗口动画
			function plusReady(){
				// 隐藏滚动条
				plus.webview.currentWebview().setStyle({scrollIndicator:'none'});
				// Android处理返回键
				plus.key.addEventListener('backbutton',function(){
					if(confirm('确认退出？')){
						plus.runtime.quit();
					}
				},false);
				compatibleAdjust();
			}
			if(window.plus){
				plusReady();
			}else{
				document.addEventListener('plusready',plusReady,false);
			}
        </script>
        
    </body>
</html>
