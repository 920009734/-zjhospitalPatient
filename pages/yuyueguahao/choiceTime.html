<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="format-detection" content="telephone=no">
        <link rel="stylesheet" href="../../css/frozen.css">
        <link rel="stylesheet" href="../../css/style.css" />
        <script src="../../lib/zepto.min.js"></script>
        <script src="../../js/frozen.js"></script>
        <script src="../../js/Utils.js"></script>
		<title>选择时间</title>
		<style type="text/css">
			html,body{font-family: "微软雅黑";height: 100%;width: 100%;}
			.doc_detai{display: block;width: 100%;height: 50px;line-height:50px;border-bottom: 1px solid #EEEAEB;background-color: #FFFFFF;}
			.date_pers{margin-left: 10px;}
			.date_type{font-size: 13px;margin-left: 15px;}
			.date_time{display: block;float:right;font-size:13px;margin-right: 10px;}
			.date_detail{display: block;width:100% ;height: 60px;border-bottom: 1px solid #EEEAEB;}
			.ck_time{display: block;float: left;margin-top:15px;margin-left:10px;width: 16%;height: 30px;text-align:center;line-height: 30px; border: 1px solid #199ED8;border-radius: 2px;color: #199ED8;font-size: 15px;}
			.detail_time{display: block;float: left;width: 100%;height: 30px;background-color: #F7F7F7;line-height: 30px;font-size: 15px;color: #4CB6AC;}
			.detail_time>p{margin-left: 10px;}
			.detail_dateTime{display: block;float: left;width: 100%;min-height: 50px;max-height: 200px;background-color: #FFFFFF;}
			.ck_dateTime{display: block;float: left;width: 100%;height: 50px;line-height: 50px;border-bottom: 1px solid #E4E4E4;font-size: 15px;}
			.ck_dateTime:last-child{border: none;}
			.slot_item{display: block;float: left;width: 94%;margin-left: 3%;height:50px;line-height: 50px;}
			.slot_item>span{display: block;float: left;}
			.time_slot{width: 54%;}
			.yuhao, .ghmoney{width: 22%;height: 30px;line-height: 30px;font-size: 13px;text-align: center;margin-top: 10px;margin-left: 1%;color: #FFFFFF;border-radius: 3px;}
			.yuhao{background-color: #3B92A6;}
			.ghmoney{background-color: #D84C29;}
			.notData{color: #999999;}
		</style>
		<script type="text/javascript">
        	$(function(){
        		
        		var Request = new Object();
        		Request = Utils.getRequest();
        		$("#deptCode").val(Request["deptCode"]);
        		$("#doctorCode").val(Request["doctorCode"]);
        		$("#doctorName").text(Request["doctorCode"]);
        		$("#deptName").text(Request["deptName"]);
        		$("#dateTime").text(Request["dateTime"]);
        		
        		var params={};
        		params.deptCode = Request["deptCode"];
        		params.doctorCode = Request["doctorCode"];
        		params.dateTime = Request["dateTime"];
        		
        		$.post(Utils.getRoot()+"/registerApp/selhasDetailTime",params,function(data){
					if (data.success) {
						
						var doctorInfo = new Array();
						doctorInfo= data.data;
						for (var i = 0; i < doctorInfo.length; i++) {
							if(doctorInfo[i].timeFlag==Request["timeFlag"]){
								if (doctorInfo[i].hasDetailTime==1) {//判断是否有分时
									//把挂号费转为元，原本是分
									var regFee = parseInt(doctorInfo[i].regFee)/100;
									$("#dateTimeDiv").append(
										"<div class='ck_dateTime'>"+
											"<div class='slot_item'>"+
												"<input type='hidden' name='timeFlag_' value='"+doctorInfo[i].timeFlag+"' />"+
												"<span class='time_slot'>"+"<span class='beginTime_'>"+doctorInfo[i].beginTime+"</span>"+"~"+"<span class='endTime_'>"+doctorInfo[i].endTime+"</span>"+"</span>"+
												"<span class='yuhao'>余号：<span class='yuhao_'>"+doctorInfo[i].leftNum+"</span></span>"+
												"<span class='ghmoney'><span>￥</span><span class='regFee'>"+regFee+"</span></span>"+
											"</div>"+
										"</div>"
									);
								}else{
									$("#dateTimeDiv").append(
										"<div class='slot_item'>"+
											"<p class='notData'>暂无数据</p>"+
										"</div>"
									);
								}
							}
						}
					}
				});
				
        		$("#dateTimeDiv").on("click",".ck_dateTime",function(){
        			if($(this).children().children(".yuhao").children(".yuhao_").text()>0){
	        			var deptCode = $("#deptCode").val();
	        			var deptName = $("#deptName").text();
	        			var doctorCode = $("#doctorCode").val();
	        			var doctorName = $("#doctorName").text();
	        			var dateTime = $("#dateTime").text();
	        			var regFee = $(this).children().children(".ghmoney").children(".regFee").text();
	        			var beginTime = $(this).children().children(".time_slot").children(".beginTime_").text();
	        			var endTime = $(this).children().children(".time_slot").children(".endTime_").text();
	        			var timeFlag = $(this).children().find("input[name='timeFlag_']").val();
	        			window.location.href="../yuyueguahao/comfirmMsg.html?deptCode="+deptCode+"&deptName="+deptName+"&doctorCode="+doctorCode+"&doctorName="+doctorName+"&dateTime="+dateTime+"&regFee="+regFee+"&beginTime="+beginTime+"&endTime="+endTime+"&timeFlag="+timeFlag;            
        			}
        		});
        	})
        </script>
	</head>
	<body ontouchstart>
		<header class="ui-header ui-header-positive">
			<i class="ui-icon ui-icon-return" onclick="history.back()"></i>
			<h4 style="margin-left: 25px;">预约时间</h4>
		</header>
		<section class="ui-container"> 
			<section id="list">
				<div class="doc_detai">
					<input type="hidden" val="" id="doctorCode">
					<span class="date_pers" id="doctorName"></span>
					<input type="hidden" val="" id="deptCode">
					<span class="date_type" id="deptName"></span>
					<span class="date_time" id="dateTime"></span>
				</div>
				<div class='time_item' id='swDiv' >
					<div class='detail_dateTime' id="dateTimeDiv">
						
					</div>
				</div>
					
				
			</section>
		</section>
	</body>
</html>
