<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="format-detection" content="telephone=no">
        <link rel="stylesheet" href="../../css/frozen.css">
        <link rel="stylesheet" href="../../css/style.css" />
        <script src="../../lib/zepto.min.js"></script>
        <script src="../../js/frozen.js"></script>
        <script src="../../js/Utils.js"></script>
		<title>选择科室</title>
		<style type="text/css">
			html,body{font-family: "微软雅黑";height: 100%;width: 100%;}
			.comfirm_item{display: block;width: 100%;height: 50px;border-bottom: 1px solid #EEEAEB;background-color: #FFFFFF;line-height: 50px;}
			.item_name{display: block;float: left; margin-left: 10px;width: 28%;}
			.comfirm_item.menz{margin-top: 0;margin-bottom: 10px;border-bottom:none}
			.login_btn{display: block;width: 90%;margin: 0 auto;margin-top: 25px;background-color: #FFFFFF;}
			.login_btn>button{border-radius:2px ;background: #167F3B;font-size: 16px;}
			.ui-radio input:checked:after{background: #167F3B;}
		</style>
	</head>
	<body ontouchstart>
		<header class="ui-header ui-header-positive">
			<i class="ui-icon ui-icon-return" onclick="history.back()"></i>
			<h4 style="margin-left: 25px;">选择支付方式</h4>
		</header>
		<section class="ui-container"> 
			<section id="list">
				<div class="comfirm_item menz">
					<span class="item_name">支付方式</span>
				</div>
				<div>
					<div class="ui-form-item ui-form-item-radio ">
                        <label class="ui-radio" for="radio">
                            <input type="radio" checked="" value="1" name="radio" />
                        </label>
                        <p>微信</p>
                    </div>
                    <div class="ui-form-item ui-form-item-radio">
                        <label class="ui-radio" for="radio">
                            <input type="radio" value="2" name="radio" />
                        </label>
                        <p>支付宝</p>
                    </div>
				</div>
				<div style="display: block;float: left;width: 100%;height: 130px; background-color: #FFFFFF;">
					<div class="login_btn">
						<button class="ui-btn ui-btn-lg ui-btn-primary" id="btn">确认</button>
					</div>
				</div>
			</section>
		</section>
		<script type="text/javascript">
			$(function(){
				
				var Request = new Object();
				Request = Utils.getRequest();
				//订单号
				var outChargeNo = Request["hisOrdNum"];
				//支付费用
				var chargeAmt = Request["regFee"];
				//支付渠道
				var channel = "";
				//商户支付日期
				var outChargeTime = "";
				var today = new Date();
				var y = today.getFullYear();    
		        var m = today.getMonth();    
		        var d = today.getDate();
				var h = today.getHours();
				var mm = today.getMinutes();
				var s = today.getSeconds();
				//日期事件处理
				function conver(s) {
					return s < 10?'0' + s:s;
				}
				outChargeTime = y + conver(m) + conver(d) + conver(h) + conver(mm) + conver(s);
				console.log(outChargeTime);		
				//订单名称
				//var subject = "易联众-支付";
				
				$("#btn").on("click", function() {
					//1、微信支付，WX_APP；2、支付宝支付，ALI_APP
					var n = $("input[name='radio']:checked").val();
					if (n == 1) {
						console.log("选择的支付方式是-WX_APP-微信。");
						channel = "WX_APP";
					} else if (n == 2) {
						console.log("选择的支付方式是-ALI_APP-支付宝。");
						channel = "ALI_APP";
					}
					
					//下单
					var params={};
					params.outChargeNo=outChargeNo;
					params.chargeAmt = chargeAmt;
					params.channel = channel;
					params.outChargeTime = outChargeTime;
					//params.subject = subject;
					$.post(Utils.getRoot()+"/registerApp/registerPay",params,function(res){
						if (res.success) {
							/*
							 返回出参
							respCode 返回码 String
							respMsg 返回说明 String
							timestamp 返回时间戳 String
							param 返回出参集合 JSON
							sign 返回出参签名 String
							signType 签名类型 String MD5
							encryptType 加密类型 String DES/AES/PLAINTEXT
							encryptData 加密数据
							-----
							出参集合(param)
							chargeNo 支付平台订单号 String
							qrCode 二维码路径 String
							html 支付表单 String 银联网页支付返回表单
							directUrl 支付地址 String 支付宝 PC、手机网页支付支付地址
							channel 支付渠道 String
							credential 支付凭证 
							 * */
							var data = new Object();
							data = res.data;
							console.log(data);
							/*var resp = data.respCode;
							var respMsg = data.respMsg;
							var timestamp = data.timestamp;
							var sign = data.sign;
							var signType = data.signType;
							var encryptType = data.encryptType;
							var encryptData = data.encryptData;
							
							console.log(resp+", "+respMsg+", "+timestamp+", "+sign+", "
								+signType+", "+encryptType+", "+encryptData);*/
							//集合
							var param = new Object();
							param = data.param;
							var chargeNo = param.chargeNo;
							var qrCode = param.qrCode;
							var html = param.html;
							var directUrl = param.directUrl;
							var channel = param.channel;
							var credential = param.credential;
							
							console.log(chargeNo+", "+qrCode+", "+html+", "+
								directUrl+", "+channel+", "+credential);
								
							
						} else {
							alert("后台处理中...");
						}
					});
				});
			});
		</script>
	</body>
</html>
