<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="format-detection" content="telephone=no">
        <link rel="stylesheet" href="../../css/frozen.css">
        <link rel="stylesheet" href="../../css/style.css" />
        <script src="../../lib/zepto.min.js"></script>
        <script src="../../js/frozen.js"></script>
        <script src="../../js/Utils.js"></script>
        <link rel="stylesheet" href="../../fontIcon/iconfont.css" />
		<title>选择医生</title>
		<style type="text/css">
			html,body{background-color: #FFFFFF;}
			.nav_date{display: none;float: left; width: 94%; overflow-x:auto;margin-left:3%;margin-bottom:10px;margin-top: 10px;}
			.nav_date.active{display: block;}
			
			.dep_name{padding-top: 6px;font-size: 16px;}
			.dep_addr{font-size: 12px;margin-top: 2px;}
			
			.date_con{display: block;width: 94%;margin: 0 auto;margin-top: 10px;}
			.con_title_right{display: block;float: right;font-size: 14px;color: #E45A33;margin-top: 2px;margin-right: 15px;}
			.con_title{font-weight: bold;}
			.con_doc{display: block;width: 100%;height: 70px;background-color: #F7F7F7;border-top: #E7E7E7;margin-bottom: 3px;}
			.con_doc>div{display: block;float: left;height: 70px;}
			.doc_img{width: 21%;}
			.doc_img>img{display:block;margin: 0 auto;margin-top: 15px;}
			.doc_detail{width: 63%;line-height: 27px;}
			.doc_yynum{width: 16%;text-align: center;}
			.doc_detail>span{display: block;width: 100%;}
			.main_doc{font-weight: 100;margin-left: 15px;font-size: 14px;}
			.doc_name{margin-top: 10px;font-weight: bold;}
			.doc_time{font-size: 14px;}
			.dep_type{margin-left: 10px;}
			.doc_yynum>span{display: block;width: 100%;line-height: 27px;}
			.yhao{margin-top: 10px;font-size: 14px;}
			.yhao_num{font-weight: bold;color: #4CB6AC;}
			.date_item{display: block;float:left;width: 500px; overflow-x: auto;}
			.date_list{display: block;float: left;width: 70px;height:60px;text-align: center;border: 1px solid #4CB6AC;border-right: none;}
			.date_list:last-child{border-right: 1px solid #4CB6AC;}
			.date_list.active{background-color: #4CB6AC;color: #FFFFFF;}
			
			.show_tab_time{display: block;float: left;width: 94%;margin-left:3%;height: 40px;}
			.show_tab_time>span{display: block;float: left;height: 30px;line-height: 30px;font-size: 15px;margin-top: 10px;}
			.nowTime{width: 35%;color: #4CB6AC;}
			.nowTime>span{display: block;float: left;height: 30px;line-height: 30px;}
			.nowTime>i{display: block;float: left; font-size: 16px;height:30px;line-height: 30px; margin-left: 5px;color: #4CB6AC;}
			.data_guahao{margin-left:8.3%;margin-right: -3px;}
			.guahao{width: 28%;border: 1px solid #000000;text-align: center;border: 1px solid #4CB6AC;border-radius: 2px;}
			.guahao.active{background-color: #4CB6AC;color: #FFFFFF;}
			::-webkit-scrollbar{width:0;height:0}
		</style>
		<script type="text/javascript">
        	$(function(){
        		var Request = new Object();
        		Request = Utils.getRequest();
        		
        		$("#deptCode").val(Request["deptCode"]);
        		$("#deptName").text(Request["deptName"]);
				var params={};
				params.deptCode=Request["deptCode"];
				params.dateTime = "2018-04-13";
        		$.post(Utils.getRoot()+"/registerApp/selclinicSchedule",params,function(data){
					if (data.success) {
						var dortorInfo = new Array();
						dortorInfo= data.data;
						var s=0,x=0,w=0;
						for (var i = 0; i < dortorInfo.length; i++) {
							if (dortorInfo[i].timeFlag==1) {//上午
								s++;
								$("#swcount").text(s+"人");
								$("#swinfoList").append(
									"<div class='con_doc'>"+
										 "<div class='doc_img'><img src='../../img/docImg.png'></div>"+
										 "<div class='doc_detail'>"+
											"<input type='hidden' value='"+dortorInfo[i].doctorCode+"' name='doctorCode'>"+
											"<input type='hidden' value='"+dortorInfo[i].timeFlag+"' name='timeFlag'>"+
											"<span class='doc_name'>"+dortorInfo[i].doctorCode+"<span class='main_doc'>主任医生</span></span>"+
										"</div>"+
										"<div class='doc_yynum'>"+
											"<span class='yhao'>余号</span>"+
											"<span class='yhao_num'>"+dortorInfo[i].leftNum+"</span>"+
										"</div>"+
									"</div>"
								);
							} else if(dortorInfo[i].timeFlag==2) {//下午
								x++;
								$("#xwcount").text(x+"人");
								$("#xwinfoList").append(
									"<div class='con_doc' >"+
										"<div class='doc_img'><img src='../../img/docImg.png'></div>"+
										 "<div class='doc_detail'>"+
											"<input type='hidden' value='"+dortorInfo[i].doctorCode+"' name='doctorCode'>"+
											"<input type='hidden' value='"+dortorInfo[i].timeFlag+"' name='timeFlag'>"+
											"<span class='doc_name'>"+dortorInfo[i].doctorCode+"<span class='main_doc'>主任医生</span></span>"+
										"</div>"+
										"<div class='doc_yynum'>"+
											"<span class='yhao'>余号</span>"+
											"<span class='yhao_num'>"+dortorInfo[i].leftNum+"</span>"+
										"</div>"+
									"</div>"
								);
							}else if(dortorInfo[i].timeFlag==3){//晚上
								w++;
								$("#wscount").text(w+"人");
								$("#wsinfoList").append(
									"<div class='con_doc'>"+
										"<div class='doc_img'><img src='../../img/docImg.png'></div>"+
										 "<div class='doc_detail'>"+
											"<input type='hidden' value='"+dortorInfo[i].doctorCode+"' name='doctorCode'>"+
											"<input type='hidden' value='"+dortorInfo[i].timeFlag+"' name='timeFlag'>"+
											"<span class='doc_name'>"+dortorInfo[i].doctorCode+"<span class='main_doc'>主任医生</span></span>"+
										"</div>"+
										"<div class='doc_yynum'>"+
											"<span class='yhao'>余号</span>"+
											"<span class='yhao_num'>"+dortorInfo[i].leftNum+"</span>"+
										"</div>"+
									"</div>"
								);
							}
							
						}
						if (s == 0) {
							$("#swDiv").hide();
						}
						if (x == 0) {
							$("#xwDiv").hide();
						}
						if (w == 0) {
							$("#wsDiv").hide();
						}
						
					}
				});
        		
        		$("#swinfoList,#xwinfoList,#wsinfoList").on("click",".con_doc",function(){
        			var doctorCode = $(this).children(".doc_detail").children("input[name='doctorCode']").val();
        			var deptCode = $("#deptCode").val();
        			var deptName = $("#deptName").text();
        			var dateTime = "2018-04-13";
        			window.location.href="../yuyueguahao/choiceTime.html?deptCode="+deptCode+"&doctorCode="+doctorCode+"&deptName="+deptName+"&dateTime="+dateTime;
        		});
        		
        	})
        </script>
		
	</head>
	<body ontouchstart>
		<header class="ui-header ui-header-positive">
			<i class="ui-icon ui-icon-return" onclick="history.back()"></i>
			<h4 style="margin-left: 25px;">
				<input type="hidden" value="" id="deptCode">
				<span id="deptName"></span>
			</h4>
		</header>
		<section class="ui-container"> 
			<section id="list">
				<div class="show_tab_time">
					<span class="nowTime ">
						<span id="nowTime"></span>
						<!--icon-xiajiantou-->
						<i class="iconfont icon-xiajiantou"></i>
					</span>
					<span class="data_guahao guahao active">按日期挂号</span>
					<span class="doct_guahao guahao ">按医生挂号</span>
				</div>
				<div class="nav_date active">
					<div class="date_item">
					</div>
					
				</div>
				
				<div style="display: block;float: left;width: 100%;">
					<!-- 上午 -->
					<div class="date_con" id="swDiv">
						<span class='con_title'>
							<font color='#3A93A5'>上午</font>
							<span class='con_title_right' id="swcount"></span>
						</span>
						<div id="swinfoList">
						</div>
					</div>
					<div class="date_con" id="xwDiv">
						<span class='con_title'>
							<font color='#3A93A5'>下午</font>
							<span class='con_title_right' id="xwcount"></span>
						</span>
						<div id="xwinfoList">
						</div>
					</div>
					<div class="date_con" id="wsDiv">
						<span class='con_title'>
							<font color='#3A93A5'>晚上</font>
							<span class='con_title_right' id="wscount"></span>
						</span>
						<div id="wsinfoList">
						
						</div>
					</div>
				</div>	
				
			</section>
		</section>
		<script type="text/javascript">
        	$(function(){
        		$("#sjxz").click(function(){
        			window.location.href="../yuyueguahao/choiceTime.html"
        		})
        	})
        </script>
		<script type="text/javascript">
			$(function(){
				$(".date_item").on("click",".date_list",function(){
					var a = $(this).hasClass("active");
					if(!a){
						$(this).addClass("active").siblings(".date_list").removeClass("active");
					}
				});
				getDay();
				var nt = new Date();
				$("#nowTime").html(nt.getFullYear()+"-"+(doHandleMonth(nt.getMonth()+1))+"-"+nt.getDate());
				$(".show_tab_time").on("click",".nowTime",function(){
					var a = $(this).hasClass("openTime");
					if(!a){
						$(".nav_date").removeClass("active");
						$(this).addClass("openTime");
						$(this).children("i").removeClass("icon-xiajiantou");
						$(this).children("i").addClass("icon-youjiantou");
					}else{
						$(".nav_date").addClass("active");
						$(this).removeClass("openTime");
						$(this).children("i").addClass("icon-xiajiantou");
						$(this).children("i").removeClass("icon-youjiantou");
					}
				});
				
				$(".show_tab_time").on("click",".guahao",function(){
					var a = $(this).hasClass("active");
					if(!a){
						$(this).addClass("active").siblings(".guahao").removeClass("active");
					}
				})
			
			});
			function getDay(){ 
		        for(var i = 0;i<7;i++){
		        	var today = new Date();
		        	var targetday_milliseconds = today.getTime() + 1000*60*60*24*i;
		        	today.setTime(targetday_milliseconds); //注意，这行是关键代码
			        var tYear = today.getFullYear();    
			        var tMonth = today.getMonth();    
			        var tDate = today.getDate();
			        var tday = today.getDay();
			        tMonth = doHandleMonth(tMonth + 1);
			        tDate = doHandleMonth(tDate);
			        if(tday == 0){
			        	tday = "天";
			        }else if(tday == 1){
			        	tday = "一";
			        }else if(tday == 2){
			        	tday = "二";
			        }else if(tday == 3){ 
			        	tday = "三";
			        }else if(tday == 4){
			        	tday = "四";
			        }else if(tday == 5){
			        	tday = "五";
			        }else if(tday == 6){
			        	tday = "六";
			        }
			        var showday = new Date();
			        if(tDate == showday.getDate()){
			        	$(".date_item").append('<div class="date_list active">'
							+'<h3 class="dep_name">星期'+tday+'</h3>'
							+'<p class="dep_addr">'+tDate+'日(有号)</p>'
							+'</div>');
			        }else{
			        	$(".date_item").append('<div class="date_list ">'
							+'<h3 class="dep_name">星期'+tday+'</h3>'
							+'<p class="dep_addr">'+tDate+'日(有号)</p>'
							+'</div>');
			        }
		        } 
			}     
			function doHandleMonth(month){    
		      	var m = month;    
			    if(month.toString().length == 1){    
			        m = "0" + month;    
			    }    
		        return m;    
			} 
		</script>
	</body>
</html>
