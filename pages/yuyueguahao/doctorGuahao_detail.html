<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="format-detection" content="telephone=no">
        <link rel="stylesheet" href="../../css/frozen.css">
        <link rel="stylesheet" href="../../css/style.css" />
        <script src="../../lib/zepto.min.js"></script>
        <script src="../../js/frozen.js"></script>
        <script src="../../js/Utils.js"></script>
        <!--<script src="../../js/doctorGuahao.js"></script>-->
        
        <link rel="stylesheet" href="../../fontIcon/iconfont.css" />
		<title>医生挂号</title>
		<style type="text/css">
			.box_detail{display: block;float: left;width: 100%;min-height: 50px;max-height: 500px;background-color: #FFFFFF;padding: 10px 0;}
			.box_detail_img{display: block;float: left;width: 22%;}
			.box_detail_img>img{display: block;width: 45px;height: 45px;margin: 0 auto;}
			.box_detail_name{display: block;float: left;height: 45px;line-height: 45px;}
			.box_detail_dep{display: block;float: left;margin-left: 10px;height: 45px;line-height: 45px;color: #999999;}
			.box_shanchang{display: block;float: left;width: 100%;margin-top: 15px;}
			.box_shanchang>span{display: block; padding: 5px 10px;color: #008080;}
			.box_shanchang>p{padding: 5px 10px;text-indent: 25px;font-size: 14px;line-height: 21px;color: #999999;}
			.box_ckTime{display: block;float: left;width: 100%;margin-top: 10px;}
			.box_item{display: block;float: left;width: 100%;background-color: #ffffff;margin-top: 10px;}
			.box_date{display: block;float: left;width: 100%;height: 40px;line-height: 40px;border-bottom: 1px solid #e7e7e7;}
			.box_date>span{padding-left: 10px;font-size: 14px;color: #999999;}
			.box_time_item{display:block;float:left;width:100%;height:50px;line-height:50px;font-size: 15px;border-bottom: 1px solid #E7E7E7;}
			.box_time_item:last-child{border: none;}
			.box_time_item>span{display: block;float: left;border-radius: 2px;}
			.box_time_item>span:nth-child(1){padding-left:10px;width: 45%;}
			.box_yuhao{width: 23%; background-color: #3B92A6;border-radius: 2px; height: 30px;line-height: 30px;margin-top: 10px;margin-right: 4%;color: #FFFFFF;font-size: 13px;text-align: center;}
			.box_ghf{width: 23%; background-color: #E04141;height: 30px;line-height: 30px;margin-top: 10px;color: #FFFFFF;font-size: 13px;text-align: center;}
		</style>
		
	</head>
	<body ontouchstart>
		<header class="ui-header ui-header-positive">
			<i class="ui-icon ui-icon-return" onclick="history.back()"></i>
			<h4 style="margin-left: 25px;">
				<input type="hidden" value="" id="deptCode">
				<span id="deptName"></span>
				<span class="reflash_item"><i class="iconfont icon-switch"></i></span>
			</h4>
		</header>
		<section class="ui-container"> 
			<div class="demo-block">
				<div class="box_detail">
					<div>
						<span class="box_detail_img"><img src="../../img/index/personLogo@2x.png"/></span>
						<input type="hidden" id="doctorCode" value=""/>
						<span class="box_detail_name" id="doctorName"></span>
						<span class="box_detail_dep" id="doctorTitle"></span>
						<span class="box_detail_dep" id="ghlx"></span>
						
					</div>
					<div class="box_shanchang">
						<span>擅长：</span>
						<p class="wenzi" id="doctorSkill"></p>
					</div>
				</div>
				
				<div class="box_ckTime" id="dateList">
					<!--<div class="box_item" >
						<div class="box_date"><span class="sj">2018-06-09</span></div>
						<div class="box_time_item">
							<span ><span>09:30</span>~<span class="endTime_">11:30</span></span>
							<span class="box_yuhao" class="leftNum">余号：<span class='yuhao_'>11</span></span>
							<span class="box_ghf"><span>￥</span><span class='regFee'>20元</span></span>
						</div>
					</div>-->
					<!--<div class="box_item">
						<div class="box_date"><span>2018-06-09</span></div>
						<div class="box_time_item">
							<span>09:30~11:30</span>
							<span class="box_yuhao">余号：11</span>
							<span class="box_ghf">￥20元</span>
						</div>
						<div class="box_time_item">
							<span>14:30~16:30</span>
							<span class="box_yuhao">余号：4</span>
							<span class="box_ghf">￥20元</span>
						</div>
					</div>-->
				</div>
			</div>
		</section>
		<!--刷新-->
		<section id="actionsheet">
			<div class="demo-item">
				<div class="demo-block">
					<div class="ui-actionsheet ">  
						<div class="ui-actionsheet-cnt">
							<button class="reflash_btn">刷新</button>  
							<button class="actionsheetClose">取消</button> 
						</div>         
					</div>
				</div>
			</div>
		</section>
		
		<script type="text/javascript">
			$(function(){
				//刷新页面
				$(".reflash_item").on("click",function(){
					$(".ui-actionsheet").addClass("show");
				});
				$(".actionsheetClose").on("click",function(){
					$(".ui-actionsheet").removeClass("show");
				});
				$(".reflash_btn").on("click",function(){
					location.reload();
					$(".ui-actionsheet").removeClass("show");
				});
				
				
				var Request = Utils.getRequest();
				
				$("#deptCode").val(Request["deptCode"]);
				$("#deptName").text(Request["deptName"]);
				$("#doctorCode").val(Request["doctorCode"]);
				$("#doctorName").text(Request["doctorName"]);
				$("#ghlx").text(Request["ghlx"]);
				var beginDate = Utils.formatDate(new Date());
				var endDate = Utils.getDateStr(7);
				
				/**
				 * 获取医生信息
				 */
				var dparams={};
				dparams.deptCode = $("#deptCode").val();
				dparams.doctorCode = $("#doctorCode").val();
				$.post(Utils.getRoot()+"/registerApp/selDoctor",dparams,function(data){
					if (data.success) {
						var dortorInfo = new Array();
						dortorInfo= data.data;
						$("#doctorTitle").text(dortorInfo[0].doctorTitle);//医生职称
						$("#doctorSkill").text(dortorInfo[0].doctorSkill);//医生擅长
					}
				});
				
				
				/**
				 * 获取7天之内的所有时间节点
				 */
				var params={};
				params.beginDate = beginDate;
				params.endDate = endDate;
				params.deptCode = $("#deptCode").val();
				params.doctorCode = $("#doctorCode").val();
				
				$.post(Utils.getRoot()+"/registerApp/selDoctorListDetail",params,function(data){
					if (data.success) {
						var dortorInfo = new Array();
						dortorInfo= data.data;
						var timeGroupBy;
						for (var i = 0; i < doctorInfo.length; i++) {
							if (doctorInfo[i].hasDetailTime==1) {//判断是否有分时
								$("#dateList").append(
									"<div class='box_item' id='hsTime"+i+"'>"+
										"<div class='box_date'><span class='sj'>"+doctorInfo[i].scheduleDate+"</span></div>"+
									"</div>"
								);
								timeGroupBy = doctorInfo[i].timeGroupBy;
								for (var j = 0; j < timeGroupBy.length; j++) {
									var regFee = parseInt(timeGroupBy[j].regFee)/100;
									$("#hsTime"+i).append(
										"<div class='box_time_item'>"+
											"<span ><span clsdd='beginTime'>"+timeGroupBy[j].beginTime+"</span>"+
											" ~ <span class='endTime'>"+timeGroupBy[j].endTime+"</span></span>"+
											"<span class='box_yuhao' >余号：<span class='leftNum'>"+timeGroupBy[j].leftNum+"</span></span>"+
											"<span class='box_ghf'><span>￥</span><span class='regFee'>"+regFee+"</span></span>"+
										"</div>"
									);
								}
							}
						}	
					}
				});
				
			});	
		</script>
	</body>
</html>
